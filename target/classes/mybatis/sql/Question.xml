<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daou.pd.admin.question.QuestionMapper">

	<select id="questionList" resultType="questionVO">
		select q_seq, q_contents, q_type, use_yn, reg_id, reg_date, upt_id, upt_date, c_seq
		from question_info
		where use_yn = 'N'
		<if test="scType != null and scType != ''">
			<if test="scType.equals('question')">
				and q_contents LIKE CONCAT('%',#{srch_input},'%')
			</if>
		</if>
	</select>

	
	<select id="questionDetail" resultType="questionVO">
		select q_seq, q_contents, q_type, use_yn, reg_id, reg_date, upt_id, upt_date, c_seq
		from question_info
		where q_seq = #{q_seq}
		and use_yn = 'N'
	</select>

	<select id="optionDetail" resultType="HashMap">
		select q.q_seq, q.q_contents, q.q_type, q.c_seq, q.reg_id, q.reg_date, q.c_seq, o.o_seq, o.o_contents , o.answer_yn
		from question_info q left join option_info o
		on q.q_seq = o.q_seq
		where q.q_seq = #{q_seq}
		and q.use_yn = 'N'
		order by o.answer_yn desc
	</select>

	<select id="selectQuestionSeq" resultType="Integer">
		select max(q_seq)
		from question_info
	</select>

	<insert id="questionReg" parameterType="questionVO">
		insert into question_info(q_contents, q_type, c_seq, reg_id, reg_date, upt_id, upt_date, use_yn)
		values(
			#{q_contents},
			#{q_type},
			#{c_seq},
			'admin',
			now(),
			null,
			null,
			'N'
		)
	</insert>

	<insert id="optionReg" parameterType="OptionVO">
		insert into
		option_info(q_seq, o_contents, answer_yn)
		values
		(
			#{q_seq},
			#{o_contents},
			#{answer_yn}
		)
	</insert>


	<update id="questionUpdt" parameterType="questionVO">
		update question_info
		set
			q_contents = #{q_contents},
			c_seq = #{c_seq}
		where q_seq = #{q_seq}
	</update>


	<delete id="deleteQuestion" parameterType="Integer">
		update question_info
		set
		use_yn = 'Y'
		where q_seq = #{q_seq}
	</delete>

	<delete id="deleteOption" parameterType="Integer">
		delete from option_info
		where q_seq = #{q_seq}
	</delete>


	<select id="categoryList" resultType="questionVO">
		select c_seq, c_name, use_yn
		from category_info
		where use_yn = 'N'
	</select>

	<select id="categoryDetail" resultType="questionVO">
		select c_seq, c_name, use_yn
		from category_info
		where c_seq = #{c_seq}
		and use_yn = 'N'
	</select>

	<insert id="categoryReg" parameterType="questionVO">
		insert into category_info(c_name,  use_yn)
		values
		(
			#{c_name},
			'N'
		)
	</insert>

	<update id="categoryUpdt" parameterType="questionVO">
		update category_info
		set
		c_name = #{c_name}
		where c_seq = #{c_seq}
	</update>

	<delete id="deleteCategory" parameterType="Integer">
		update category_info
		set use_yn = 'Y'
		where c_seq = #{c_seq}
	</delete>
</mapper>	 